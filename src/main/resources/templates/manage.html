<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Manage Pricing - [[${bar.barName}]]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
    <nav class="navbar navbar-dark bg-warning text-dark">
        <div class="container-fluid">
            <span class="navbar-brand text-dark">
                <i class="bi bi-tag"></i> Pricing - [[${bar.barName}]]
            </span>
        </div>
    </nav>

    <div class="container mt-4">
        <h4>Set Product Prices</h4>
        <p class="text-muted">Configure selling and cost prices for each product at this bar</p>
        
        <div class="table-responsive mt-3">
            <table class="table table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Product Name</th>
                        <th>Category</th>
                        <th>Brand</th>
                        <th>Selling Price (₹)</th>
                        <th>Cost Price (₹)</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="product : ${products}">
                        <td><strong th:text="${product.productName}"></strong></td>
                        <td th:text="${product.category}"></td>
                        <td th:text="${product.brand}"></td>
                        <td>
                            <input type="number" class="form-control form-control-sm selling-price" 
                                   th:id="'selling-' + ${product.productId}"
                                   th:data-product="${product.productId}"
                                   step="0.01" placeholder="0.00">
                        </td>
                        <td>
                            <input type="number" class="form-control form-control-sm cost-price" 
                                   th:id="'cost-' + ${product.productId}"
                                   th:data-product="${product.productId}"
                                   step="0.01" placeholder="0.00">
                        </td>
                        <td>
                            <button class="btn btn-sm btn-success" 
                                    th:onclick="'savePrice(' + ${product.productId} + ')'">
                                <i class="bi bi-save"></i> Save
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="alert alert-info mt-3">
            <strong>Current Prices:</strong>
            <ul>
                <li th:each="price : ${prices}">
                    <strong th:text="${price.product.productName}"></strong>: 
                    Selling: ₹<span th:text="${price.sellingPrice}"></span>, 
                    Cost: ₹<span th:text="${price.costPrice}"></span>
                </li>
            </ul>
        </div>
        
        <div class="mt-3">
            <a href="/" class="btn btn-secondary">
                <i class="bi bi-house"></i> Home
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
        const barId = [[${bar.barId}]];
        const existingPrices = /*[[${prices}]]*/ [];
        
        // Load existing prices
        existingPrices.forEach(price => {
            const sellingInput = document.getElementById('selling-' + price.product.productId);
            const costInput = document.getElementById('cost-' + price.product.productId);
            if (sellingInput) sellingInput.value = price.sellingPrice;
            if (costInput) costInput.value = price.costPrice;
        });
        
        function savePrice(productId) {
            const sellingPrice = parseFloat(document.getElementById('selling-' + productId).value);
            const costPrice = parseFloat(document.getElementById('cost-' + productId).value) || 0;
            
            if (!sellingPrice || sellingPrice <= 0) {
                alert('Please enter a valid selling price');
                return;
            }
            
            const data = {
                sellingPrice: sellingPrice,
                costPrice: costPrice,
                active: true
            };
            
            fetch(`/api/pricing/${barId}/${productId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                alert('Price saved successfully!');
                location.reload();
            })
            .catch(error => {
                alert('Error saving price: ' + error);
            });
        }
    </script>
</body>
</html>
